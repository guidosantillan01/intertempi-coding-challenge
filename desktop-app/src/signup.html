<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Signup</title>
  </head>

  <body>
    <h1>Create an Account</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="signup.html">Sign Up</a></li>
        <li><a href="login.html">Log In</a></li>
        <li><a href="content.html">Content</a></li>
      </ul>
    </nav>

    <form>
      <div>
        <label>Email:</label>
        <input type="text" id="email" autofocus />
      </div>
      <div>
        <label>Password:</label>
        <input type="password" id="password" />
      </div>
      <button type="submit">Submit</button>
    </form>

    <script>
      const form = document.querySelector('form');
      const handleSubmit = function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        console.log(email, password);

        const configuration = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email,
            password
          })
        };
        return fetch('http://localhost:3000/signup', configuration)
          .then(handleErrors)
          .then((res) => res.json())
          .then((response) => {
            console.log('User created!');
            localStorage.setItem('token', response.token);
            console.log(response.token);
            window.location.href = 'content.html';
          })
          .catch((err) => console.log(err));
      };

      function handleErrors(response) {
        if (!response.ok) {
          throw Error(response.statusText);
        }
        return response;
      }

      form.addEventListener('submit', handleSubmit);
    </script>
  </body>
</html>
