<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Signup</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css"
    />
    <script
      defer
      src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"
    ></script>
  </head>

  <body>
    <h1>Signup</h1>
    <nav id="menu">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="login.html">Login</a></li>
      </ul>
    </nav>

    <form>
      <div>
        <label>Email:</label>
        <input type="text" id="email" autofocus />
      </div>
      <div>
        <label>Password:</label>
        <input type="password" id="password" />
      </div>
      <button type="submit">Submit</button>
    </form>

    <div id="form-message"></div>

    <script>
      const form = document.querySelector('form');
      const handleSubmit = function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;

        const configuration = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            email,
            password
          })
        };
        return fetch('http://localhost:3000/signup', configuration)
          .then(handleErrors)
          .then((res) => res.json())
          .then((response) => {
            localStorage.setItem('token', response.token);
            window.location.href = 'index.html';
          })
          .catch((err) => {
            document.getElementById('form-message').innerHTML =
              '<p>Unable to create an account</p>';
          });
      };

      function handleErrors(response) {
        if (!response.ok) {
          throw Error(response.statusText);
        }
        return response;
      }

      form.addEventListener('submit', handleSubmit);
    </script>
  </body>
</html>
